# mysql 使用规范

## 命名规范

- 库名、表名、字段名禁⽌使用MySQL保留字
- 临时库、表名必须以tmp为前缀，并以⽇期为后缀
- 备份库、表必须以bak为前缀，并以日期为后缀
- 命名只允许使用小写字符和下划线
- 普通索引命名格式：ix_[列名]
- 唯一索引命名格式：uk_[列名]

## 基础规范

- 使用INNODB存储引擎
- 表字符集使用utf8mb4
- 所有表都需要添加注释
- 单表数据量建议控制在5千万以内
- 不在数据库中存储图⽚、文件等大数据
- 禁止在线上做数据库压力测试
- 禁⽌从测试、开发环境直连数据库
- 禁止超过3个以上的表join，核心业务场景禁止join（可以适度冗余字段来避免join，或者由业务层实现）

## 库、表、字段开发设计规范

- 拆分大字段和访问频率低的字段，分离冷热数据
- 按日期时间分表需符合YYYY[MM][DD][HH]格式
- 存储精确浮点数用DECIMAL，不用FLOAT和DOUBLE
- 枚举字段使用TINYINT，不用ENUM
- 所有字段均定义为NOT NULL，原因：NULL字段很难查询优化，NULL字段的索引需要额外空间，NULL字段的复合索引无效
- 使用UNSIGNED存储非负整数
- 使用TIMESTAMP存储时间，并且默认值设为CURRENT_TIMESTAMP
- 使用INT UNSIGNED存储IP
- 使用VARBINARY存储大小写敏感的变长字符串
- 禁止在数据库中存储明文密码，把密码加密后存储
- 少用TEXT/BLOB，VARCHAR的性能会比TEXT高很多，如果确实需要用到，建议拆表
- 表列数不能超过60，太多的列可能意味着业务可能需要拆分/解耦
- 自增列不能设置默认值，且名称必须是id

## 索引规范

- 单张表中索引数量不超过5个
- 单个索引中的字段数不超过5个
- 对字符串使⽤用前缀索引，前缀索引长度不超过8个字符
- 表必须有主键，建议使用 `id BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键'`
- 不使用更新频繁的列作为主键
- 尽量不选择字符串列作为主键
- 不使用UUID MD5 HASH这些作为主键（数值太离散）
- 重要的SQL必须被索引，比如：UPDATE、DELETE语句的WHERE条件列；ORDER BY、GROUP BY、DISTINCT的字段
- 多表JOIN的时候区分度最大的字段放在前面
- 避免冗余和重复索引
- 不在低基数列上建立索引，例如“性别”
- 不在索引列进行数学运算和函数运算
- 尽量不使用外键，外键用来保护参照完整性，可在业务端实现
- 禁止使用全文索引
- 新建的唯一索引必须不能和主键重复
- 索引字段的默认值不能为NULL，NULL非常影响索引的查询效率
- 反复查看与表相关的SQL，符合最左前缀的特点建立索引。多条字段重复的语句，要修改语句条件字段的顺序，为其建立一条联合索引，减少索引数量
- 组合索引列数不能超过3个，不得出现重复列，不能包含主键索引列和唯一索引列，时间类型只能出现在索引尾部
- 经常使用explain来观察索引是否正确设置
